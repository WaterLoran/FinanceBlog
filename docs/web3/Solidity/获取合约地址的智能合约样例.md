# 获取合约地址的智能合约样例

以下是一个简单的智能合约，演示如何获取合约地址：

## 基础版本

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ContractAddress {
    // 获取当前合约的地址
    function getContractAddress() public view returns (address) {
        return address(this);
    }
    
    // 获取合约的余额
    function getContractBalance() public view returns (uint256) {
        return address(this).balance;
    }
    
    // 接收以太币的函数
    receive() external payable {}
    
    fallback() external payable {}
}
```

## 增强版本（包含更多功能）

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract AdvancedContractAddress {
    address public owner;
    uint256 public creationTimestamp;
    
    // 构造函数 - 部署时记录信息
    constructor() {
        owner = msg.sender;
        creationTimestamp = block.timestamp;
    }
    
    // 获取当前合约地址
    function getContractAddress() public view returns (address) {
        return address(this);
    }
    
    // 获取合约创建者地址
    function getOwnerAddress() public view returns (address) {
        return owner;
    }
    
    // 获取调用者地址
    function getCallerAddress() public view returns (address) {
        return msg.sender;
    }
    
    // 获取合约余额
    function getContractBalance() public view returns (uint256) {
        return address(this).balance;
    }
    
    // 获取合约创建时间
    function getCreationTime() public view returns (uint256) {
        return creationTimestamp;
    }
    
    // 比较地址
    function isOwner() public view returns (bool) {
        return msg.sender == owner;
    }
    
    // 获取交易信息
    function getTransactionInfo() public view returns (address, uint256, uint256) {
        return (
            msg.sender,          // 调用者地址
            msg.value,           // 发送的以太币数量
            block.timestamp      // 当前时间戳
        );
    }
    
    // 向合约存款
    function deposit() public payable {
        // 存款逻辑，通过 msg.value 接收以太币
    }
    
    // 仅允许所有者提取资金
    function withdraw(uint256 amount) public {
        require(msg.sender == owner, "Only owner can withdraw");
        require(amount <= address(this).balance, "Insufficient balance");
        payable(owner).transfer(amount);
    }
    
    // 接收以太币的函数
    receive() external payable {}
    
    fallback() external payable {}
}
```

## 工厂合约（部署其他合约并获取地址）

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ContractFactory {
    address[] public deployedContracts;
    
    event ContractDeployed(address contractAddress, address deployer, uint256 timestamp);
    
    // 部署新合约并返回地址
    function deployNewContract() public returns (address) {
        AdvancedContractAddress newContract = new AdvancedContractAddress();
        address contractAddress = address(newContract);
        
        deployedContracts.push(contractAddress);
        
        emit ContractDeployed(contractAddress, msg.sender, block.timestamp);
        
        return contractAddress;
    }
    
    // 获取所有已部署合约的地址
    function getAllDeployedContracts() public view returns (address[] memory) {
        return deployedContracts;
    }
    
    // 获取部署的合约数量
    function getDeployedCount() public view returns (uint256) {
        return deployedContracts.length;
    }
}
```

## 在 Remix 中测试的步骤：

1. **部署合约**：
   - 编译合约
   - 在 "Deploy & Run Transactions" 中部署

2. **获取合约地址**：
   ```javascript
   // 方法1：查看部署后的合约实例
   // 在 Remix 的 "Deployed Contracts" 区域可以看到合约地址
   
   // 方法2：调用合约函数
   // 点击 getContractAddress() 函数获取地址
   
   // 方法3：查看交易详情
   // 在部署交易的详情中可以看到合约创建地址
   ```

3. **测试功能**：
   - 调用 `getContractAddress()` 查看合约地址
   - 调用 `getOwnerAddress()` 查看部署者地址
   - 发送一些 ETH 到合约，然后调用 `getContractBalance()`

## 关键知识点：

- `address(this)`：获取当前合约的地址
- `msg.sender`：获取函数调用者的地址
- `address(this).balance`：获取合约的 ETH 余额
- `block.timestamp`：获取当前区块的时间戳

这个合约不仅展示了如何获取合约地址，还包含了常见的合约模式和最佳实践，如权限控制、事件记录和资金管理。