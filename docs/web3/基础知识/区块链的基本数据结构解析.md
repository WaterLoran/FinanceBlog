# 区块链的基本数据结构解析

---

### 核心结构：区块 + 链

区块链的本质是一个**只可追加的、按时间顺序排列的分布式交易日志**。其数据结构可以分解为以下几个层级：

#### 1. 交易 - 数据的原子单元

交易是区块链上记录状态变更的最小单位。

*   **结构**：
    *   **版本号**：指明交易遵循的规则。
    *   **输入**：说明资金的来源（引用之前的交易输出）。
    *   **输出**：指定资金的去向和花费条件（锁定脚本）。
    *   **数字签名**：由付款方生成，用于授权花费输入。
    *   **其他数据**：在智能合约平台（如以太坊）上，还包含`gasLimit`、`gasPrice`、`data`字段（用于调用合约）。

#### 2. 区块 - 交易的容器

一个区块就像账簿中的一页，它由**区块头**和**区块体**组成。

##### **A. 区块头 - 区块的“元数据和指纹”**

区块头包含了该区块的摘要信息和链接到前一个区块的指针。它是形成“链”的关键，通常包含以下字段：

1.  **版本号**：指明区块验证遵循的规则。
2.  **前一区块哈希**：**这是形成“链”的核心！** 指向上一个区块头的哈希值。任何对前一个区块的修改都会导致其哈希值改变，从而破坏整个后续链条。
3.  **默克尔根**：**这是高效验证交易完整性的核心！** 它是通过将本区块中所有交易构建成一棵默克尔树，最终计算出的一个根哈希值。
4.  **时间戳**：区块大致的生成时间。
5.  **难度目标**：当前网络挖矿难度的指标，用于工作量证明。
6.  **随机数**：一个用于工作量证明挖矿的计数器。矿工通过不断改变这个数值来寻找一个满足特定条件的哈希值。

##### **B. 区块体 - 交易的“清单”**

区块体包含了该区块打包的所有交易记录。通常第一笔交易是 **Coinbase 交易**（或称创币交易），这是给矿工的区块奖励和手续费。

---

### 关键数据结构的核心技术

#### 1. 哈希指针链

这是区块链不可篡改性的密码学基础。

*   **普通指针**：告诉你数据存储在哪里。
*   **哈希指针**：不仅告诉你位置，还包含该数据的**密码学哈希值**，允许你**验证数据是否被篡改**。

**工作原理**：
*   每个区块的头部都包含前一个区块头的哈希值。
*   如果攻击者修改了区块N中的任何数据，会导致区块N的哈希值改变。
*   由于区块N+1的头部记录的是区块N的原哈希值，这个变化会被立刻发现。
*   为了掩盖修改，攻击者必须连续修改区块N+1, N+2, ... 的所有哈希值，这需要在下一个区块被网络确认之前完成，这在计算上是不可行的。

#### 2. 默克尔树

这是一种二叉树结构，用于高效地汇总和验证大量数据的完整性。

**构建过程（以4笔交易为例）**：
1.  首先，对每笔交易（Tx0, Tx1, Tx2, Tx3）计算其哈希值（H0, H1, H2, H3）。
2.  然后将相邻的两个交易哈希拼接后再次哈希（例如，H01 = Hash(H0 + H1)）。
3.  重复这个过程，直到最终生成一个唯一的**默克尔根**，并存入区块头。

**核心价值**：
*   **高效验证**：允许进行**简洁验证**。要证明某笔交易（如Tx2）是否存在于某个区块中，你不需要下载整个区块的所有交易，只需要提供从Tx2到默克尔根路径上的少量哈希值（H3, H01），即可完成验证。这对于手机轻钱包至关重要。
*   **数据完整性**：任何一笔交易的微小变动都会导致默克尔根彻底改变，从而被轻易发现。

---

### 不同区块链的细微差异

虽然核心结构相似，但不同区块链在数据组织上各有特点：

| 特性             | 比特币                   | 以太坊                                   |
| :--------------- | :----------------------- | :--------------------------------------- |
| **核心数据结构** | UTXO 模型                | 账户余额模型                             |
| **交易类型**     | 描述价值的转移           | 可包含调用智能合约的代码                 |
| **状态存储**     | 所有未花费交易输出的集合 | 所有账户（外部账户和合约账户）的当前状态 |
| **“世界状态”**   | 通过UTXO集合隐式表示     | 通过状态树显式存储，并定期更新状态根     |

*   **比特币**：更像一本**流水账**，记录每一笔钱的来龙去脉。它的状态是所有**未花费交易输出**的集合。
*   **以太坊**：更像一台**状态机**。每个区块都包含了从上一个状态到新状态的转换。它的状态是所有账户（包括合约账户）的余额和存储。

### 总结：数据结构如何赋予区块链其特性

区块链的基本数据结构共同赋予了它三大核心特性：

1.  **不可篡改性**：
    *   由**哈希指针链**实现。修改历史区块在计算上不可行。

2.  **数据完整性**：
    *   由**默克尔树**实现。可以快速、高效地验证任何交易是否被包含在区块中，且未被篡改。

3.  **去中心化信任**：
    *   这种清晰、可验证的数据结构，使得网络中的任何节点都可以独立验证整个账本的历史和当前状态，而无需信任任何中心化机构。

简而言之，区块链通过将**交易**打包进**区块**，并使用**密码学哈希**将这些区块**链式链接**起来，构建了一个安全、透明、可验证的分布式数据库。